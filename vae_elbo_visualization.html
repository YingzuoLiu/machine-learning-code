<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAE ELBO 可视化解释</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .vae-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .component {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 150px;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .encoder {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        
        .latent {
            background: linear-gradient(45deg, #4834d4, #686de0);
        }
        
        .decoder {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
        }
        
        .arrow {
            font-size: 2em;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .formula {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            text-align: center;
            border-left: 4px solid #ffd700;
        }
        
        .explanation {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #32ff7e;
        }
        
        .loss-visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .loss-term {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .loss-term:hover {
            transform: scale(1.05);
        }
        
        .reconstruction {
            border: 3px solid #ff6b6b;
        }
        
        .kl-reg {
            border: 3px solid #4834d4;
        }
        
        .interactive-demo {
            margin: 30px 0;
            text-align: center;
        }
        
        .slider-container {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .slider {
            width: 200px;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        .balance-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }
        
        .balance-bar {
            flex: 1;
            height: 30px;
            border-radius: 15px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .balance-fill {
            height: 100%;
            border-radius: 15px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .highlight {
            background: linear-gradient(45deg, #ffd700, #ffb347);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
        }
        
        @media (max-width: 768px) {
            .vae-diagram {
                flex-direction: column;
            }
            
            .loss-visualization {
                grid-template-columns: 1fr;
            }
            
            .balance-display {
                flex-direction: column;
                gap: 15px;
            }
            
            .balance-bar {
                width: 100%;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 VAE 的 ELBO 目标函数可视化解释</h1>
        
        <!-- VAE 架构图 -->
        <div class="section">
            <h2>📊 VAE 架构概览</h2>
            <div class="vae-diagram">
                <div class="component encoder">
                    <h3>编码器</h3>
                    <p>x → μ, σ</p>
                    <small>将输入编码为分布参数</small>
                </div>
                <div class="arrow">→</div>
                <div class="component latent">
                    <h3>潜在空间</h3>
                    <p>z ~ N(μ, σ²)</p>
                    <small>从分布中采样</small>
                </div>
                <div class="arrow">→</div>
                <div class="component decoder">
                    <h3>解码器</h3>
                    <p>z → x'</p>
                    <small>重建原始输入</small>
                </div>
            </div>
        </div>
        
        <!-- ELBO 公式解释 -->
        <div class="section">
            <h2>🎯 ELBO 目标函数</h2>
            <div class="formula">
                ELBO = 𝔼[log p(x|z)] - KL(q(z|x) || p(z))
            </div>
            <div class="formula">
                ↓ 实际优化目标 ↓
            </div>
            <div class="formula highlight">
                Loss = 重建损失 + β × KL散度
            </div>
            
            <div class="explanation">
                <strong>为什么是这两项？</strong>
                <br>• <strong>重建损失</strong>：确保解码器能准确重建输入
                <br>• <strong>KL正则</strong>：约束潜在分布接近先验分布N(0,1)
            </div>
        </div>
        
        <!-- 损失项可视化 -->
        <div class="section">
            <h2>🔍 β参数的作用机制</h2>
            <div class="explanation">
                <h3>β的数学含义：</h3>
                <div class="formula">
                    ℒ = 重建损失 + <span style="color: #ffd700; font-size: 1.5em;">β</span> × KL正则项
                </div>
                <ul>
                    <li><strong>β = 1:</strong> 标准VAE，理论最优</li>
                    <li><strong>β > 1:</strong> β-VAE，更强的正则化，有利于解耦表征</li>
                    <li><strong>β < 1:</strong> 弱化正则，提高重建质量</li>
                    <li><strong>β = 0:</strong> 退化为普通自编码器</li>
                </ul>
            </div>
        </div>
        <div class="section">
            <h2>⚖️ 两个损失项的作用</h2>
            <div class="loss-visualization">
                <div class="loss-term reconstruction">
                    <h3>🔧 重建损失项</h3>
                    <p><strong>目标：</strong> 最大化 log p(x|z)</p>
                    <p><strong>作用：</strong></p>
                    <ul style="text-align: left;">
                        <li>确保生成的图像与原图相似</li>
                        <li>训练解码器的重建能力</li>
                        <li>保证信息不丢失</li>
                    </ul>
                    <div style="background: rgba(255, 107, 107, 0.3); padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <strong>如果只有这一项：</strong><br>
                        模型会记住每个样本的精确位置，无法生成新样本
                    </div>
                </div>
                
                <div class="loss-term kl-reg">
                    <h3>📏 KL正则项</h3>
                    <p><strong>目标：</strong> 最小化 KL(q(z|x) || N(0,1))</p>
                    <p><strong>作用：</strong></p>
                    <ul style="text-align: left;">
                        <li>约束潜在空间的分布形状</li>
                        <li>确保潜在空间连续平滑</li>
                        <li>使随机采样生成有意义</li>
                    </ul>
                    <div style="background: rgba(72, 52, 212, 0.3); padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <strong>如果只有这一项：</strong><br>
                        所有点都会塌陷到原点，失去重建能力
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 交互式演示 -->
        <div class="section">
            <h2>🎮 交互式权重调节</h2>
            <div class="interactive-demo">
                <p>调节 β 参数来看两个损失项的权衡：</p>
                <div class="slider-container">
                    <label>KL权重 β:</label>
                    <input type="range" id="betaSlider" class="slider" min="0" max="2" step="0.1" value="1">
                    <span id="betaValue">1.0</span>
                </div>
                
                <div class="balance-display">
                    <div style="text-align: center; font-weight: bold;">
                        重建损失<br>
                        <span id="reconWeight">50%</span>
                    </div>
                    <div class="balance-bar">
                        <div id="reconBar" class="balance-fill" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); width: 50%;">
                            重建
                        </div>
                        <div id="klBar" class="balance-fill" style="background: linear-gradient(45deg, #4834d4, #686de0); width: 50%; position: absolute; right: 0; top: 0;">
                            KL正则
                        </div>
                    </div>
                    <div style="text-align: center; font-weight: bold;">
                        KL正则<br>
                        <span id="klWeight">50%</span>
                    </div>
                </div>
                
                <div id="effectDescription" class="explanation">
                    <strong>当前效果：</strong> 重建质量和生成多样性达到平衡
                </div>
            </div>
        </div>
        
        <!-- 直觉理解 -->
        <div class="section">
            <h2>💡 直觉理解</h2>
            <div class="explanation">
                <h3>🤔 为什么需要这两项？</h3>
                <p><strong>类比：</strong>想象你在学习画画</p>
                <ul>
                    <li><strong>重建损失</strong> = 临摹能力：你必须能准确复制看到的图像</li>
                    <li><strong>KL正则</strong> = 创作规范：你的创作风格要遵循某种"标准"，不能太随意</li>
                </ul>
                
                <h3>🎯 ELBO的本质</h3>
                <p>ELBO是变分推断的核心，它是真实对数似然的<strong>下界</strong>：</p>
                <div class="formula">
                    log p(x) ≥ ELBO = 𝔼[log p(x|z)] - KL(q(z|x) || p(z))
                </div>
                <p>最大化ELBO = 最大化重建概率 + 保持分布规整</p>
            </div>
        </div>
        
        <!-- 常见问题 -->
        <div class="section">
            <h2>❓ 常见疑问解答</h2>
            <div class="explanation">
                <h3>Q: 为什么不直接最大化 log p(x)？</h3>
                <p>A: 因为 p(x) = ∫ p(x|z)p(z)dz 的积分难以计算，所以用变分推断找下界</p>
                
                <h3>Q: β-VAE 中的 β 有什么作用？</h3>
                <p>A: β 控制解码质量vs潜在空间规整性的权衡。β>1时更重视解耦，β<1时更重视重建</p>
                
                <h3>Q: KL散度为0时会怎样？</h3>
                <p>A: 所有潜在向量都变成标准正态分布，失去了编码输入的能力</p>
            </div>
        </div>
    </div>
    
    <script>
        const betaSlider = document.getElementById('betaSlider');
        const betaValue = document.getElementById('betaValue');
        const reconWeight = document.getElementById('reconWeight');
        const klWeight = document.getElementById('klWeight');
        const reconBar = document.getElementById('reconBar');
        const klBar = document.getElementById('klBar');
        const effectDescription = document.getElementById('effectDescription');
        
        function updateBalance() {
            const beta = parseFloat(betaSlider.value);
            betaValue.textContent = beta.toFixed(1);
            
            // 计算相对权重
            const total = 1 + beta;
            const reconPercent = (1 / total * 100);
            const klPercent = (beta / total * 100);
            
            reconWeight.textContent = `${reconPercent.toFixed(0)}%`;
            klWeight.textContent = `${klPercent.toFixed(0)}%`;
            
            reconBar.style.width = `${reconPercent}%`;
            klBar.style.width = `${klPercent}%`;
            
            // 更新效果描述
            let description = '';
            if (beta < 0.3) {
                description = '<strong>β < 0.3:</strong> 重建质量优先，可能出现过拟合，潜在空间混乱';
            } else if (beta < 0.8) {
                description = '<strong>0.3 ≤ β < 0.8:</strong> 偏重重建，适合高质量图像生成任务';
            } else if (beta <= 1.2) {
                description = '<strong>0.8 ≤ β ≤ 1.2:</strong> 平衡状态，标准VAE配置，重建和生成兼顾';
            } else if (beta <= 1.8) {
                description = '<strong>1.2 < β ≤ 1.8:</strong> 偏重正则化，潜在空间更规整，有利于插值和解耦';
            } else {
                description = '<strong>β > 1.8:</strong> 强正则化，可能牺牲重建质量，适合解耦表征学习';
            }
            
            effectDescription.innerHTML = description;
        }
        
        betaSlider.addEventListener('input', updateBalance);
        
        // 添加一些动态效果
        document.querySelectorAll('.component').forEach((comp, index) => {
            comp.style.animationDelay = `${index * 0.2}s`;
        });
    </script>
</body>
</html>