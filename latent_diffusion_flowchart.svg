<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <rect width="1200" height="800" fill="#f8fafc"/>
  
  <!-- 标题 -->
  <text x="600" y="30" text-anchor="middle" class="title" font-size="24" font-weight="bold" fill="#1e293b">Latent Diffusion Model 结构流程图</text>
  
  <!-- 输入图像区域 -->
  <g id="input-section">
    <rect x="50" y="80" width="120" height="80" fill="#ddd6fe" stroke="#7c3aed" stroke-width="2" rx="8"/>
    <text x="110" y="115" text-anchor="middle" font-size="12" font-weight="bold" fill="#5b21b6">输入图像</text>
    <text x="110" y="130" text-anchor="middle" font-size="10" fill="#5b21b6">512×512×3</text>
  </g>
  
  <!-- VAE Encoder -->
  <g id="vae-encoder">
    <rect x="220" y="70" width="100" height="100" fill="#fed7d7" stroke="#dc2626" stroke-width="2" rx="8"/>
    <text x="270" y="110" text-anchor="middle" font-size="12" font-weight="bold" fill="#dc2626">VAE</text>
    <text x="270" y="125" text-anchor="middle" font-size="12" font-weight="bold" fill="#dc2626">Encoder</text>
    <text x="270" y="145" text-anchor="middle" font-size="10" fill="#dc2626">下采样8倍</text>
  </g>
  
  <!-- 潜在空间 -->
  <g id="latent-space">
    <rect x="370" y="80" width="120" height="80" fill="#dcfce7" stroke="#16a34a" stroke-width="2" rx="8"/>
    <text x="430" y="115" text-anchor="middle" font-size="12" font-weight="bold" fill="#16a34a">潜在空间</text>
    <text x="430" y="130" text-anchor="middle" font-size="10" fill="#16a34a">64×64×4</text>
  </g>
  
  <!-- 噪声添加 -->
  <g id="noise-addition">
    <rect x="370" y="200" width="120" height="60" fill="#fef3c7" stroke="#d97706" stroke-width="2" rx="8"/>
    <text x="430" y="225" text-anchor="middle" font-size="12" font-weight="bold" fill="#d97706">添加噪声</text>
    <text x="430" y="240" text-anchor="middle" font-size="10" fill="#d97706">t步噪声</text>
  </g>
  
  <!-- 文本编码器 -->
  <g id="text-encoder">
    <rect x="50" y="300" width="120" height="80" fill="#e0e7ff" stroke="#3b82f6" stroke-width="2" rx="8"/>
    <text x="110" y="330" text-anchor="middle" font-size="12" font-weight="bold" fill="#3b82f6">文本编码器</text>
    <text x="110" y="345" text-anchor="middle" font-size="10" fill="#3b82f6">CLIP/T5</text>
    <text x="110" y="360" text-anchor="middle" font-size="10" fill="#3b82f6">77×768</text>
  </g>
  
  <!-- U-Net主体 -->
  <g id="unet">
    <rect x="550" y="180" width="300" height="280" fill="#f1f5f9" stroke="#475569" stroke-width="3" rx="12"/>
    <text x="700" y="205" text-anchor="middle" font-size="16" font-weight="bold" fill="#475569">U-Net 扩散模型</text>
    
    <!-- 下采样路径 -->
    <g id="downsampling">
      <rect x="570" y="220" width="80" height="50" fill="#fee2e2" stroke="#ef4444" stroke-width="2" rx="6"/>
      <text x="610" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#ef4444">下采样</text>
      <text x="610" y="255" text-anchor="middle" font-size="9" fill="#ef4444">Encoder</text>
      
      <rect x="570" y="280" width="80" height="50" fill="#fee2e2" stroke="#ef4444" stroke-width="2" rx="6"/>
      <text x="610" y="300" text-anchor="middle" font-size="11" font-weight="bold" fill="#ef4444">下采样</text>
      <text x="610" y="315" text-anchor="middle" font-size="9" fill="#ef4444">Block</text>
    </g>
    
    <!-- 瓶颈层 -->
    <g id="bottleneck">
      <rect x="660" y="250" width="80" height="50" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="6"/>
      <text x="700" y="270" text-anchor="middle" font-size="11" font-weight="bold" fill="#f59e0b">瓶颈层</text>
      <text x="700" y="285" text-anchor="middle" font-size="9" fill="#f59e0b">Bottleneck</text>
    </g>
    
    <!-- 上采样路径 -->
    <g id="upsampling">
      <rect x="750" y="220" width="80" height="50" fill="#dcfce7" stroke="#22c55e" stroke-width="2" rx="6"/>
      <text x="790" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#22c55e">上采样</text>
      <text x="790" y="255" text-anchor="middle" font-size="9" fill="#22c55e">Decoder</text>
      
      <rect x="750" y="280" width="80" height="50" fill="#dcfce7" stroke="#22c55e" stroke-width="2" rx="6"/>
      <text x="790" y="300" text-anchor="middle" font-size="11" font-weight="bold" fill="#22c55e">上采样</text>
      <text x="790" y="315" text-anchor="middle" font-size="9" fill="#22c55e">Block</text>
    </g>
    
    <!-- 交叉注意力层 -->
    <g id="cross-attention">
      <rect x="580" y="350" width="240" height="80" fill="#f3e8ff" stroke="#9333ea" stroke-width="2" rx="8"/>
      <text x="700" y="375" text-anchor="middle" font-size="14" font-weight="bold" fill="#9333ea">交叉注意力机制 (Cross-Attention)</text>
      <text x="620" y="395" text-anchor="start" font-size="10" fill="#7c3aed">• Query: 图像特征</text>
      <text x="620" y="410" text-anchor="start" font-size="10" fill="#7c3aed">• Key/Value: 文本特征</text>
      <text x="620" y="425" text-anchor="start" font-size="10" fill="#7c3aed">• 实现文本-图像对齐</text>
    </g>
  </g>
  
  <!-- 去噪输出 -->
  <g id="denoised-output">
    <rect x="900" y="200" width="120" height="60" fill="#dcfce7" stroke="#16a34a" stroke-width="2" rx="8"/>
    <text x="960" y="225" text-anchor="middle" font-size="12" font-weight="bold" fill="#16a34a">去噪输出</text>
    <text x="960" y="240" text-anchor="middle" font-size="10" fill="#16a34a">64×64×4</text>
  </g>
  
  <!-- VAE Decoder -->
  <g id="vae-decoder">
    <rect x="1050" y="150" width="100" height="100" fill="#fed7d7" stroke="#dc2626" stroke-width="2" rx="8"/>
    <text x="1100" y="190" text-anchor="middle" font-size="12" font-weight="bold" fill="#dc2626">VAE</text>
    <text x="1100" y="205" text-anchor="middle" font-size="12" font-weight="bold" fill="#dc2626">Decoder</text>
    <text x="1100" y="225" text-anchor="middle" font-size="10" fill="#dc2626">上采样8倍</text>
  </g>
  
  <!-- 输出图像 -->
  <g id="output-image">
    <rect x="1050" y="300" width="120" height="80" fill="#ddd6fe" stroke="#7c3aed" stroke-width="2" rx="8"/>
    <text x="1110" y="335" text-anchor="middle" font-size="12" font-weight="bold" fill="#5b21b6">生成图像</text>
    <text x="1110" y="350" text-anchor="middle" font-size="10" fill="#5b21b6">512×512×3</text>
  </g>
  
  <!-- 时间步编码 -->
  <g id="time-embedding">
    <rect x="50" y="420" width="120" height="60" fill="#fce7f3" stroke="#ec4899" stroke-width="2" rx="8"/>
    <text x="110" y="445" text-anchor="middle" font-size="12" font-weight="bold" fill="#ec4899">时间步编码</text>
    <text x="110" y="460" text-anchor="middle" font-size="10" fill="#ec4899">t ∈ [0,1000]</text>
  </g>
  
  <!-- 连接线 -->
  <!-- 输入到VAE编码器 -->
  <path d="M170 120 L220 120" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- VAE编码器到潜在空间 -->
  <path d="M320 120 L370 120" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 潜在空间到噪声添加 -->
  <path d="M430 160 L430 200" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 噪声添加到U-Net -->
  <path d="M490 230 L550 230" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 文本编码器到U-Net -->
  <path d="M170 340 L580 385" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 时间步到U-Net -->
  <path d="M170 450 L580 400" stroke="#ec4899" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- U-Net到去噪输出 -->
  <path d="M850 230 L900 230" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 去噪输出到VAE解码器 -->
  <path d="M1020 230 L1050 200" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- VAE解码器到输出 -->
  <path d="M1100 250 L1100 300" stroke="#374151" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- U-Net内部连接 -->
  <path d="M650 245 L660 275" stroke="#666" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M740 275 L750 245" stroke="#666" stroke-width="1" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 跳跃连接 -->
  <path d="M610 270 Q700 240 790 270" stroke="#94a3b8" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="700" y="235" text-anchor="middle" font-size="9" fill="#64748b">Skip Connection</text>
  
  <!-- 箭头标记定义 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>
  
  <!-- 说明文字 -->
  <g id="explanations">
    <text x="50" y="550" font-size="14" font-weight="bold" fill="#1e293b">关键组件说明:</text>
    <text x="50" y="580" font-size="12" fill="#475569">1. VAE编码器: 将高分辨率图像压缩到低维潜在空间，减少计算量</text>
    <text x="50" y="600" font-size="12" fill="#475569">2. U-Net: 在潜在空间中进行去噪，包含自注意力和交叉注意力机制</text>
    <text x="50" y="620" font-size="12" fill="#475569">3. 交叉注意力: 将文本特征作为K,V，图像特征作为Q，实现文本指导</text>
    <text x="50" y="640" font-size="12" fill="#475569">4. VAE解码器: 将潜在表示重建为高分辨率图像</text>
    <text x="50" y="660" font-size="12" fill="#475569">5. 时间步编码: 告诉模型当前去噪进度，指导去噪强度</text>
    
    <text x="50" y="700" font-size="14" font-weight="bold" fill="#dc2626">优势: 相比像素空间扩散，计算效率提升64倍 (8×8压缩)</text>
  </g>
  
  <!-- 样式定义 -->
  <style>
    .title { font-family: Arial, sans-serif; }
    text { font-family: Arial, sans-serif; }
  </style>
</svg>